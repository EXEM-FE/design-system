# Load NVM and set PATH for pnpm (VSCode Source Control compatibility)
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

# 🔄 토큰 자동 생성 (stylesheet 변경 시)
if git diff --cached --name-only | grep -q "packages/stylesheet/src/global.css"; then
  echo "🔄 CSS 변경 감지 - 토큰 자동 생성 중..."
  pnpm --filter @exem-fe/design-token generate
  git add packages/design-token/src/tokens/*.ts
  echo "✅ 토큰 생성 완료 및 스테이징 추가됨"
fi

# 🎨 lint-staged로 스테이징된 파일만 포맷팅 및 린팅
echo "🎨 Formatting and linting staged files..."
npx lint-staged || {
    echo "⚠️  Some lint issues remain (auto-generated files ignored)"
    exit 0
}

# 타입 체크 실행  
echo "🔧 Type checking..."
pnpm typecheck

echo "✅ Pre-commit checks passed!"
